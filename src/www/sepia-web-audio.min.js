//SEPIA Web Audio Lib v0.9.11 min - https://github.com/SEPIA-Framework/sepia-web-audio
"object"==typeof SepiaFW||(SepiaFW={}),function(a){function b(){return k=!!j&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,!!k||void 0}function c(a,b){if(!a||!a.size)b();else if("function"==typeof a.arrayBuffer)a.arrayBuffer().then(function(a){b(a)}).catch(function(a){console.error("blobToArray '.arrayBuffer' ERROR",a),b()});else{var c=new FileReader;c.onload=function(){b(c.result)},c.onerror=function(a){console.error("blobToArray 'FileReader' ERROR",reader.error,a),b()},c.readAsArrayBuffer(a)}}function d(a){return new Promise(function(b,c){i.readFileAsBuffer(a,function(a){b(a)},function(a){c(a)})})}function e(a){return new Promise(function(b,c){i.readFileAsText(a,function(a){b(a)},function(a){c(a)})})}function f(a,b,c,d){var e=new XMLHttpRequest;e.open("GET",b),e.responseType=a,e.timeout=i.contentFetchTimeout,e.onload=function(){200<=e.status&&300>e.status?c(e.response):d({status:e.status,message:e.statusText})},e.onerror=function(a){d(a)},e.ontimeout=function(a){d(a)},e.send()}function g(a){try{for(var b=atob(a),c=new Uint8Array(b.length),d=0;d<b.length;++d)c[d]=b.charCodeAt(d);return c}catch(a){throw new Error("Converting base64 string to Uint8Array bytes array failed.")}}function h(){}var i=a.webAudio||{};i.version="0.9.11";var j=window.AudioContext||window.webkitAudioContext,k=void 0;i.isStreamRecorderSupported=b(),i.isNativeStreamResamplingSupported=!0,i.tryNativeStreamResampling=!0,i.contentFetchTimeout=8e3,i.defaultProcessorOptions={moduleFolder:"modules",initSuccessCallback:console.log,initErrorCallback:console.error,onerror:console.error};var l={};i.clearPreLoadCache=function(){l={}},i.getSupportedAudioConstraints=function(){var a=navigator.mediaDevices.getSupportedConstraints(),b={},c=i.overwriteSupportedAudioConstraints;return a.deviceId&&(b.deviceId=null==c.deviceId?void 0:c.deviceId),a.channelCount&&(b.channelCount=null==c.channelCount?1:c.channelCount),a.noiseSuppression&&(b.noiseSuppression=null==c.noiseSuppression||c.noiseSuppression),a.autoGainControl&&(b.autoGainControl=null!=c.autoGainControl&&c.autoGainControl),a.echoCancellation&&(b.echoCancellation=null!=c.echoCancellation&&c.echoCancellation),a.sampleRate&&(b.sampleRate=null==c.sampleRate?48e3:c.sampleRate),b},i.overwriteSupportedAudioConstraints={},i.defaultMimeTypesForCodecs={ogg:"audio/ogg",ogg_opus:"audio/ogg;codecs=opus",ogg_vorbis:"audio/ogg;codecs=vorbis",ogg_speex:"audio/ogg;codecs=speex",opus:"audio/opus",vorbis:"audio/vorbis",speex:"audio/speex",wav:"audio/wav",raw:"audio/wav",webm_ogg_opus:"audio/webm;codecs=opus",webm_ogg_vorbis:"audio/webm;codecs=vorbis",webm_mkv_pcm:"audio/webm;codecs=pcm",mp3:"audio/mpeg",mp4:"audio/mp4",flac:"audio/flac",mpeg:"audio/mpeg"},i.getSupportedMediaRecorderCodecs=function(){var a={};return window.MediaRecorder&&Object.keys(i.defaultMimeTypesForCodecs).forEach(function(b){var c=i.defaultMimeTypesForCodecs[b];window.MediaRecorder.isTypeSupported(c)&&(a[b]=c)}),a},i.createAudioContext=function(a,b){var c={};!b&&a.targetSampleRate&&(c.sampleRate=a.targetSampleRate);var d=new j(c);return d},i.Processor=function(a,b,c){function f(b){a.debugLog&&a.debugLog("Started init. condition: "+b),I[b]=1}function j(c){I[c]&&(delete I[c],a.debugLog&&a.debugLog("Completed init. condition: "+c),0==Object.keys(I).length&&!F&&(clearTimeout(A),F=!0,G=!1,b({name:"ProcessorReady",message:"Processor is ready for action",inputSampleRate:v,targetSampleRate:a.targetSampleRate||v,sourceInfo:J,modulesInfo:K})))}function k(){clearTimeout(A),F=!1,G=!1,I={},f("sourceSetup"),f("modulesSetup")}function m(a){k(),c(a)}async function n(b,c){if(w&&b&&("closed"!=w.state&&(await w.close()),w=null),!w||"closed"==w.state)if(w=i.createAudioContext(a,c),null==a.startSuspended||a.startSuspended){try{await w.resume()}catch(a){}await w.suspend()}else await w.resume();return w}async function o(){if(a.modules)for(let b=0;b<a.modules.length;b++){let c=a.modules[b],d=p(c),e=d.moduleType,f=d.moduleName;if(1==e){let b=C+f+".js";a.debugLog&&a.debugLog("Adding audioWorklet module: "+b);try{await w.audioWorklet.addModule(b)}catch(c){console.error(c),a.debugLog&&a.debugLog("FAILED to add audioWorklet module: "+b+" - Msg.: "+c.name+", "+c.message)}}else if(2==e){let b=C+f.replace(/-worker$/,"")+"-worker.js";a.debugLog&&a.debugLog("Adding worker module: "+b)}else if(3==e)throw{name:"CreateModuleError",message:"ScriptProcessor nodes are currently not supported as modules (only source)."};else if(4==e)throw{name:"CreateModuleError",message:"AudioNodes are currently not supported as modules (you can use them as custom source)."};else throw{name:"CreateModuleError",message:"Module type unknown."}}}function p(a){var b,c,d,e;return"object"==typeof a?(b=a.type&&"worker"==a.type||a.isWorker?2:a.type&&"scriptProcessor"==a.type?3:a.type&&"audioNode"==a.type?4:1,c=a.name,d=a.setup||a.settings,e=a.preLoad||{}):(b=1,c=a,d={},e={}),{moduleType:b,moduleName:c,moduleSetup:d,modulePreLoads:e}}function q(){E=!0}function r(){E=!1}function s(b,c,h){var k=b.length;if(a.modules&&a.modules.length){var n=Array(a.modules.length),o=a.modules.length;a.modules.forEach(async function(q,r){function i(a){if(!a||null==a.data);else if(1==a.data.moduleState)D.isReady=!0,j("module-"+r),a.data.moduleInfo&&(D.moduleInfo=a.data.moduleInfo),n[r]={moduleName:D.moduleName,moduleInfo:D.moduleInfo},0==--o&&h(n);else if(9==a.data.moduleState&&!D.isTerminated){if("function"==typeof D.terminate)try{D.isTerminated=!0,D.terminate()}catch(a){D.isTerminated=!0,s({name:"TerminateError",message:"Failed to terminate module",info:a})}}else if(10==a.data.moduleState)a.data.error.target=a.target,s(a.data.error);else if(a.data.moduleResponse);else x.sendToModules&&(a.data.moduleEvent?x.sendToModules.forEach(function(c){b[c]&&!b[c].ignoreSendToModules&&b[c].sendToModule({ctrl:{action:"handle",data:a.data}})}):x.sendToModules.forEach(function(c){b[c]&&!b[c].ignoreSendToModules&&b[c].sendToModule({ctrl:{action:"process",data:a.data}})}));x.onmessage&&x.onmessage(a.data,b)}function s(a){var b;a.message&&0==a.message.indexOf("Uncaught {")?(a.preventDefault(),b=JSON.parse(a.message.replace(/^Uncaught /,"")),a.message=b):b=a,B({name:"AudioModuleProcessorException",message:"Error in module: "+a.target.moduleName+" - "+(b&&b.message?b.message:"Check console for details."),module:a.target.moduleName,info:b}),G&&!F&&m({message:"Error during setup of module: "+D.moduleName,name:"ProcessorInitError",info:b}),x.onerror&&x.onerror(a)}if(G){f("module-"+r);var t=p(q),u=t.moduleType,v=t.moduleName,x=t.moduleSetup,y={},z=Object.keys(t.modulePreLoads);try{await Promise.all(z.map(async function(a){var b=t.modulePreLoads[a],c=1,f=void 0;"object"==typeof b?(c=b.type&&(2==b.type||"arraybuffer"==b.type.toLowerCase())?2:1,b=b.path||b.url):0==a.indexOf("wasmFile")?c=2:0==a.indexOf("wasmBase64")&&(c=1,f=g);var h=a+"_"+b;if(l[h])y[a]=l[h];else try{var i;if(!b||2<c)throw{name:"PreLoadError",message:"Missing 'path' (url) or unsupported type (use 1=text or 2=arraybuffer)"};else 1==c?i=await e(b):2==c&&(i=await d(b));"function"==typeof f&&(i=f(i)),y[a]=i,l[h]=i}catch(b){throw{name:"AddModuleError",message:"Failed to pre-load data: "+a+" - name: "+v,info:b}}}))}catch(a){return void m(a)}var A=x.options||{};A.preLoadResults=y;var D;if(1==u){if(!c)return void m({name:"AddModuleError",message:"Source does not support 'AudioWorkletProcessor' (use only workers instead) - name: "+v});A.processorOptions||(A.processorOptions=A.setup||{}),A.processorOptions.ctxInfo||(A.processorOptions.ctxInfo={sampleRate:w.sampleRate,targetSampleRate:a.targetSampleRate}),D=new AudioWorkletNode(w,v,A),D.isReady=!1,D.moduleName=v,D.port.onmessage=i,D.onprocessorerror=s,D.sendToModule=function(a){D.isReady?D.port.postMessage(a):B({name:"AudioModuleProcessorException",message:"'sendToModule' was called before module was actually ready. Consider 'startSuspended' option maybe.'",module:D.moduleName})}}else if(2==u)A.setup||(A.setup={}),A.setup.ctxInfo||(A.setup.ctxInfo={sampleRate:w.sampleRate,targetSampleRate:a.targetSampleRate}),D=new Worker(C+v.replace(/-worker$/,"")+"-worker.js"),D.isReady=!1,D.moduleName=v,D.onmessage=i,D.onerror=s,D.sendToModule=function(a){D.isReady?D.postMessage(a):a&&a.ctrl&&"construct"==a.ctrl.action?D.postMessage(a):B({name:"AudioModuleProcessorException",message:"'sendToModule' was called before module was actually ready. Consider 'startSuspended' option maybe.",module:D.moduleName})},D.sendToModule({ctrl:{action:"construct",options:A}});else return 3==u?void m({name:"AddModuleError",message:"ScriptProcessor nodes are currently not supported as modules (only source)."}):4==u?void m({name:"AddModuleError",message:"AudioNodes are currently not supported as modules (you can use them as custom source)."}):void m({name:"AddModuleError",message:"Unknown module type."});if(D.moduleType=u,D.ignoreSendToModules=!1,D.deactivate=function(){D.ignoreSendToModules=!0,E&&(D.sendToModule({ctrl:{action:"stop"}}),D.sendToModule({ctrl:{action:"reset"}}))},D.activate=function(){D.ignoreSendToModules=!1,E&&D.sendToModule({ctrl:{action:"start"}})},q.handle=D,!c&&0==r){var H=b[0];if(!H.onmessage)return void m({name:"AddModuleError",message:"If source is not compatible to 'AudioWorklet' it has to have a 'onmessage' event to get the processed data."});H.onmessage=function(a){a&&null!=a.data&&(a.data.moduleEvent||a.data.sourceEvent?D.sendToModule({ctrl:{action:"handle",data:a.data}}):D.sendToModule({ctrl:{action:"process",data:a.data}}))}}b[k+r]=D}})}else h([])}function t(b,c,d){v=w.sampleRate,d||(d={}),a.targetSampleRate&&a.targetSampleRate!=v&&(i.isNativeStreamResamplingSupported=!1,D=v-a.targetSampleRate);var e=[b],f=[],g=!0;null==d.hasWorkletSupport?"scriptProcessor"==d.type&&(g=!1):g=d.hasWorkletSupport,s(e,g,function(a){K=a,j("modulesSetup"),u.processNodes=e;let b=!1;if(e.forEach(function(a){g&&(!a.moduleType||1==a.moduleType)&&f.push(a),a.moduleInfo&&a.moduleInfo.resamplingMode&&(b=!0)}),D&&!b)return void m({message:"Samplerate mismatch and no resampler found!",name:"ProcessorInitError"})});var k=a.destinationNode||w.destination;u.mainAudioContext=w,u.source=b,u.sourceInfo=d,J=d,c||(c={}),x=function(a,b){Promise.resolve((c.onBeforeStart||h)()).then(function(){return w.resume()}).then(function(){if(1<f.length){for(var a=1;a<f.length;a++)f[a-1].connect(f[a]);f[a-1].connect(k)}else 1==f.length?f[0].connect(k):e[0].connect&&e[0].connect(k);return(e.forEach(function(a){a.sendToModule&&a.sendToModule({ctrl:{action:"start",options:{}}})}),c.onAfterStart)?Promise.resolve(c.onAfterStart()):void 0}).then(a).catch(function(a){B({name:"ProcessorStartError",message:a.name+" - Message: "+(a.message||a)}),b&&b(a)})},y=function(a,b){Promise.resolve((c.onBeforeStop||h)()).then(function(){return e.forEach(function(a){a.disconnect&&a.disconnect(),a.sendToModule&&a.sendToModule({ctrl:{action:"stop",options:{}}})}),w.suspend()}).then(function(){if(c.onAfterStop)return Promise.resolve(c.onAfterStop())}).then(a).catch(function(a){B({name:"ProcessorStopError",message:a.name+" - Message: "+(a.message||a)}),b&&b(a)})},z=function(a,b){Promise.resolve((c.onBeforeRelease||h)()).then(function(){return e.forEach(function(a,b){a.sendToModule&&a.sendToModule({ctrl:{action:"release",options:{}}}),e[b]=null}),u.processNodes=null,u.source=null,w.close()}).then(function(){if(c.onAfterRelease)return Promise.resolve(c.onAfterRelease())}).then(a).catch(function(a){B({name:"ProcessorReleaseError",message:a.name+" - Message: "+(a.message||a)}),b&&b(a)})},j("sourceSetup")}var u=this;c||(c=i.defaultProcessorOptions.initErrorCallback),b||(b=i.defaultProcessorOptions.initSuccessCallback),a||(a={});var v,w,x,y,z,A,B=a.onerror||i.defaultProcessorOptions.onerror,C=(a.moduleFolder||i.defaultProcessorOptions.moduleFolder).replace(/\/$/,"")+"/",D=0,E=!1,F=!1,G=!1,H=a.initializerTimeout||3e3,I={},J={},K=[];if(k(),G=!0,A=setTimeout(function(){m({message:"Initialization took too long! If you expect long running init. process use option 'initializerTimeout' (ms).",name:"ProcessorInitTimeout"})},H),!i.isStreamRecorderSupported&&!a.customSourceTest&&!a.customSource){return void m({name:"NotSupportedError",message:"Cannot create audio stream recorder because there are no compatible interfaces!"})}if(a.customSourceTest){let b;i.createWhiteNoiseGeneratorNode(.1,{targetSampleRate:a.targetSampleRate}).then(function(a){return b=a,w=a.context,o()}).then(function(){t(b,{},{type:"whiteNoiseGenerator"})}).catch(function(a){m(a)})}else if(a.customSource){let b=a.customSource.node;w=b.context,o().then(function(){t(b,{onBeforeStart:a.customSource.beforeStart,onAfterStart:a.customSource.start||a.customSource.afterStart,onBeforeStop:a.customSource.stop||a.customSource.beforeStop,onAfterStop:a.customSource.afterStop,onBeforeRelease:a.customSource.beforeRelease,onAfterRelease:a.customSource.release||a.customSource.afterRelease},{type:a.customSource.type||"custom",typeData:a.customSource.typeData,hasWorkletSupport:null==a.customSource.hasWorkletSupport||a.customSource.hasWorkletSupport})}).catch(function(a){m(a)})}else{let b;i.getMicrophone(a,n).then(function(a){return b=a,o()}).then(function(){t(b.source,b.controls||{},b.info)}).catch(function(a){"string"==typeof a?m({message:a,name:"ProcessorInitError"}):m({message:a.message,name:a.name,ref:a})})}u.start=function(b,c,d){F&&!E?x(function(){var c=new Date().getTime();q(),a.onaudiostart&&a.onaudiostart({startTime:c}),b&&b()},d):c&&c()},u.stop=function(b,c,d){E?y(function(){var c=new Date().getTime();r(),a.onaudioend&&a.onaudioend({endTime:c}),b&&b()},d):c&&c()},u.release=function(b,c,d){F&&z?z(function(){k(),a.onrelease&&a.onrelease(),b&&b()},d):G?m({message:"Release was called before initialization was complete.",name:"ProcessorInitError"}):c&&c()},u.isInitialized=function(){return F},u.isInitPending=function(){return G},u.isProcessing=function(){return E}},i.getAudioDevices=function(a){return new Promise(function(b,c){(async function(){if(!navigator.mediaDevices.enumerateDevices)return c({message:"MediaDevices 'enumerateDevices' is not available! Check if context is secure (SSL, HTTPS, etc.).",name:"NotSupportedError"});var d=!1,e=void 0;navigator.mediaDevices.enumerateDevices().then(function(a){if(!d){clearTimeout(e);var c={},f={};return a.forEach(function(a){"audioinput"==a.kind?c[a.label]=a.deviceId:"audiooutput"==a.kind&&(f[a.label]=a.deviceId)}),b({input:c,output:f})}}).catch(function(a){return c(a)}),e=setTimeout(function(){return d=!0,c({message:"Media device enumeration timeout. Permission might require user interaction.",name:"TimeoutError"})},a||5e3)})()})},i.getMicrophone=function(a,b,c){return a||(a={}),b||(b=async function(b,c){var d=i.createAudioContext(a,c);if(null==a.startSuspended||a.startSuspended){try{await d.resume()}catch(a){}await d.suspend()}else await d.resume();return d}),new Promise(function(d,e){(async function(){var f=JSON.parse(JSON.stringify(i.getSupportedAudioConstraints()));f.sampleRate&&a.targetSampleRate&&(f.sampleRate=a.targetSampleRate);var g={video:!1,audio:!Object.keys(f).length||f};if(!navigator.mediaDevices.getUserMedia)return e({message:"MediaDevices 'getUserMedia' is not available! Check if context is secure (SSL, HTTPS, etc.).",name:"NotSupportedError"});var h=!1,j=void 0;navigator.mediaDevices.getUserMedia(g).then(async function(c){if(!h){clearTimeout(j);var f=i.tryNativeStreamResampling&&i.isNativeStreamResamplingSupported?await b(!1,!1):await b(!1,!0);var g;try{g=f.createMediaStreamSource(c)}catch(d){f=await b(!0,!0),g=f.createMediaStreamSource(c),d&&d.name&&"NotSupportedError"==d.name&&(i.isNativeStreamResamplingSupported=!1,a.debugLog&&a.debugLog("Native stream resampling has been deactivated - Info: "+d.message))}a.destinationNode||(a.destinationNode=f.createMediaStreamDestination());var k,l={type:"mic"};if(g.mediaStream&&g.mediaStream.getAudioTracks)try{k=g.mediaStream.getAudioTracks()[0],l.label=k.label,l.settings=k.getSettings?k.getSettings():{},l.settings.sampleRate=f.sampleRate}catch(a){}var m={onBeforeStart:function(){},onAfterStop:function(){},onAfterRelease:function(){k&&"function"==typeof k.stop&&"live"==k.readyState&&k.stop()}};return d({source:g,controls:m,info:l})}}).catch(function(a){return e(a)}),j=setTimeout(function(){return h=!0,e({message:"Media 'getUserMedia' timeout. Permission might require user interaction.",name:"TimeoutError"})},c||5e3)})()})},i.createAudioRecorder=function(a,b,c){return c||(c={}),c.codec||(c.codec="webm_ogg_opus"),new Promise(function(d,e){(async function(){try{var f=b.settings.sampleRate;if(!f)return e({message:"Sample-rate unknown! Please add correct 'sourceInfo'.",name:"AudioRecorderError"});var g=b.settings.channelCount;if(1<g)return e({message:"Sorry, but this recorder only supports MONO audio at the moment.",name:"NotSupportedError"});var h=c.mimeType||i.defaultMimeTypesForCodecs[c.codec]||i.defaultMimeTypesForCodecs.webm_ogg_opus,j=c.sampleTime||(c.chunkSize?Math.floor(1e3/f*c.chunkSize):0);if(j&&c.decodeToAudioBuffer&&console.error("WARNING: Partial decoding is not supported at the moment! It is possible but requires adding custom headers for each blob!"),!window.MediaRecorder)return e({message:"'MediaRecorder' is not available!",name:"NotSupportedError"});if(!MediaRecorder.isTypeSupported(h))return e({message:"MIME-Type '"+h+"' is not supported!",name:"NotSupportedError"});var k,l,m=new MediaRecorder(a,{mimeType:h,bitsPerSecond:2*f*g}),n=!1;m.onerror=c.onerror||console.error,c.onstart&&(m.onstart=c.onstart),c.onpause&&(m.onpause=c.onpause),c.onresume&&(m.onresume=c.onresume);var o=c.onstop;m.onstop=function(){o&&!c.decodeToAudioBuffer&&o()};var p=c.ondataavailable||c.onprocess;c.decodeToAudioBuffer?p&&(m.ondataavailable=function(a){if("inactive"==m.state&&(n=!0),a&&a.data){let b=Date.now();i.offlineAudioContextBlobDecoder(f,g,a.data,function(a){a&&p({data:a.getChannelData(0),decodeTime:Date.now()-b}),!n&&c.recordLimitMs&&Date.now()-k>=c.recordLimitMs?r():n&&o&&o()})}}):p&&(m.ondataavailable=function(a){p(a),c.recordLimitMs&&Date.now()-k>=c.recordLimitMs&&r()});var q,r=function(){q&&clearTimeout(q),l=Date.now(),"inactive"!=m.state&&m.stop()},s=function(){k=Date.now(),l=void 0,n=!1,j?m.start(j):(m.start(),c.recordLimitMs&&(q=setTimeout(r,c.recordLimitMs)))};return d({getMediaRecorder:function(){return m},mimeType:h,sourceInfo:b,sampleTime:j,start:s,stop:r})}catch(a){return console.error("AudioRecorder",a),e(a)}})()})},i.offlineAudioContextBlobDecoder=function(a,b,d,e){c(d,function(c){if(!c)e();else{var d=new OfflineAudioContext(b,c.byteLength,a);d.decodeAudioData(c,function(a){e(a)},function(a){console.error("offlineAudioContext.decodeAudioData ERROR",a),e()})}})},i.blobToArray=c,i.createLegacyMicrophoneScriptProcessor=function(a){return a||(a={}),i.getMicrophone(a,void 0).then(function(b){var c=b.source,d=c.context,f=d.sampleRate,g=a.bufferSize||2048,h=1,i=d.createScriptProcessor(g,h,h);c.connect(i);var j={node:i,type:"scriptProcessor",typeData:b.info,hasWorkletSupport:!1,start:function(){b.controls.onAfterStart&&b.controls.onAfterStart()},stop:function(){b.controls.onBeforeStop&&b.controls.onBeforeStop()},release:function(){b.controls.onAfterRelease&&b.controls.onAfterRelease()}};if(b.controls&&(b.controls.onBeforeStart&&(j.beforeStart=b.controls.onBeforeStart),b.controls.onAfterStop&&(j.afterStop=b.controls.onAfterStop),b.controls.onBeforeRelease&&(j.beforeRelease=b.controls.onBeforeRelease)),a.onaudioprocess)i.onaudioprocess=a.onaudioprocess;else{function b(a){if(a&&a.inputBuffer){var b=[a.inputBuffer.getChannelData(0)];i.onmessage({data:{samples:b,sampleRate:f,channels:h,type:b[0].constructor.name}})}}i.onaudioprocess=function(a){b(a)},i.onmessage=a.onmessage||function(){}}return j})},i.createWhiteNoiseGeneratorNode=function(a,b,c){b||(b={});var d=i.defaultProcessorOptions.moduleFolder.replace(/\/$/,"")+"/";return new Promise(function(e,f){(async function(){try{var g=i.createAudioContext(b);try{await g.resume()}catch(a){}await g.suspend();await g.audioWorklet.addModule(d+"white-noise-generator.js");var h=new AudioWorkletNode(g,"white-noise-generator",{processorOptions:{gain:a||.1}});c&&(h.port.onmessage=c),e(h)}catch(a){return f(a)}})()})},i.createFileSource=function(a,b,c,d){return b||(b={}),new Promise(function(e,f){try{function g(a){f(a)}function h(f){i.createAudioBufferSource(f,b,c,d).then(function(b){b.typeData={fileUrl:a},e(b)}).catch(g)}i.readFileAsBuffer(a,h,g)}catch(a){f(a)}})},i.createAudioBufferSource=function(a,b,c,d){return b||(b={}),new Promise(function(e,f){(async function(){try{var g=i.createAudioContext(b);try{await g.resume()}catch(a){}await g.suspend();var h=g.createBufferSource();g.decodeAudioData(a,function(a){return h.buffer=a,h.loop=null==c||c,d&&(h.onended=d),e({node:h,type:"fileAudioBuffer",typeData:{},start:function(){h.start()},stop:function(){h.stop()},release:function(){}})},function(a){return f(a)})}catch(a){return f(a)}})()})},i.createSourceAudioPlayer=function(a,b,c,d,e){b||(b={}),b.modules=c||[],b.customSource=a,b.startSuspended==null&&(b.startSuspended=!0);var f=new i.Processor(b,d,e);return f},i.encodeWaveBuffer=function(a,b,c,d,f,g){var h=i.defaultProcessorOptions.moduleFolder.replace(/\/$/,"")+"/",j=new Worker(h+"wave-encoder-worker.js");f||(f=console.log),g||(g=console.error);var k={setup:{inputSampleRate:b,inputSampleSize:a.length,lookbackBufferMs:0}};j.onmessage=function(h){1==h.data.moduleState?j.postMessage({encode:{format:"wave",data:{samples:[a],sampleRate:b,channels:c,isFloat32:d}}}):h.data.encoderResult&&(j.terminate(),h.data.error?g({name:"EncoderError",message:h.data.error}):f(h.data.encoderResult))},j.onerror=function(a){j.terminate(),g(a)},j.postMessage({ctrl:{action:"construct",options:k}})},i.decodeAudioFile=function(a,b,c,d,e){i.readFileAsBuffer(a,function(a){var f=new OfflineAudioContext(c,a.byteLength,b);f.decodeAudioData(a,function(a){d(a)},function(a){e(a)})},function(a){e(a)})},i.decodeAudioFileToInt16Mono=function(a,b,c,d){i.decodeAudioFile(a,b,1,function(a){i.encodeWaveBuffer(a.getChannelData(0),b,1,!0,function(a){try{var b=new Int16Array(a.wav.buffer);c(b)}catch(a){d(a)}},d)},d)},i.resampleBufferViaSpeex=function(a,b,c,d,e,f,g){f||(f=console.log),g||(g=console.error);try{var h=new OfflineAudioContext(d,a.length,b),j=i.defaultProcessorOptions.moduleFolder.replace(/\/$/,"")+"/",k="speex-resample-switch";h.audioWorklet.addModule(j+k+".js").then(function(){var d={processorOptions:{ctxInfo:{sampleRate:b},targetSampleRate:c,resampleQuality:e,bufferSize:a.length}},i=new AudioWorkletNode(h,k,d);i.port.onmessage=function(b){1==b.data.moduleState?i.port.postMessage({resample:{samples:[a],isInt16:!0}}):b.data.resampleResult&&(h=null,b.data.error?g({name:"ResampleError",message:b.data.error}):f(b.data.resampleResult))},i.onprocessorerror=function(a){h=null,g(a)}})}catch(a){g(a)}},i.readFileAsBuffer=function(a,b,c){SepiaFW&&SepiaFW.files?SepiaFW.files.fetch(a,b,c,"arraybuffer",i.contentFetchTimeout):f("arraybuffer",a,b,c)},i.readFileAsText=function(a,b,c){SepiaFW&&SepiaFW.files?SepiaFW.files.fetch(a,b,c,void 0,i.contentFetchTimeout):f("text",a,b,c)},i.base64={base64StringToUint8Array:g,uint8ArrayToBase64String:function(a){try{return btoa(a.reduce(function(a,b){return a+String.fromCharCode(b)},""))}catch(a){throw new Error("Converting Uint8Array to base64 string failed.")}}},i.addAudioElementToPage=function(a,b,c){var d=document.createElement("audio");d.src=window.URL.createObjectURL("Blob"==b.constructor.name?b:new Blob([b],{type:c||"audio/wav"})),d.setAttribute("controls","controls");var e=document.createElement("div");return e.appendChild(d),a||(a=document.body),a.appendChild(e),d};a.webAudio=i}(SepiaFW);